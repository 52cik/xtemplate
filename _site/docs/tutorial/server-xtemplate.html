<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>xtemplate - xtemplate on server</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="nico 0.5.1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link type="image/x-icon" href="/favicon.ico" rel="icon">
    <link rel="stylesheet" href="../../static/css/normalize.css" />
    <link rel="stylesheet" href="../../static/css/site.css" />
    <link rel="stylesheet" href="../../static/css/solarized.css" />
<script>
if (!location.port) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-50522089-2', 'auto');
  ga('send', 'pageview');
}
</script>
<script src="../../static/js/sea.js?nowrap"></script>

<script>
  seajs.config({
    base: "../../",
    alias: {}
  });
</script>
    <!--[if lt IE 9]>
    <script src="../../static/js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body class="spmjs">
    <div class="body-wrapper">
      <aside class="sidebar-wrapper">
      <h1>
          <a href="../../">Xtemplate</a>
      </h1>
      <p class="sidebar-version">Version: <a href="http://spmjs.io/package/xtemplate" title="">4.0.3</a></p>
        <p class="sidebar-description" data-keyword="template"></p>
        <a class="sidebar-source" href="http://github.com/kissyteam/xtemplate" target="_blank">View the Project</a>
        <ul class="sidebar-navigation" role="navigation">
          <li><a href="../../">Doc</a></li>
          <li><a class="test-link" href="../../tests/runner.html" target="_blank">Test</a></li>
          <li><a class="issue-link" href="http://github.com/kissyteam/xtemplate/issues" target="_blank">Issues</a></li>
        </ul>
        
<ol class="sidenav">
  <li><a href="impl.html">构建前端 DSL template</a></li>
  <li><a href="introduce.html">introduce xtemplate</a></li>
  <li><a href="kg-xtemplate.html">xtemplate on kg</a></li>
  <li><a href="performance-hint.html">performance hint</a></li>
  <li><a href="server-xtemplate.html">xtemplate on server</a></li>
  <li><a href="use-on-browser.html">use XTemplate on browser</a></li>
</ol>

        <div class="qrcode-wrapper">
          <i class="icon iconfont">
            &#x3433;
            <div class="qrcode" id="qrcode"></div>
          </i>
        </div>
      </aside>
      <div class="content-wrapper">
        
<article class="hentry">
  <h1 class="entry-title">xtemplate on server</h1>
  <div class="entry-content">
    <p>By minghe36@126.com</p>
<p>xtemplate除了在浏览器端使用外，还可以在服务器端使用，比如结合Node.js的express或koa框架使用。</p>
<p>通常express搭配的模板引擎是jade，但jade的写法与原生html差很远，不习惯的话不妨试试xtemplate。</p>
<h2 id="在express中使用xtemplate">在express中使用xtemplate<a href="#在express中使用xtemplate" class="anchor">¶</a></h2><p>一个demo工程，xtemplate的模板都放在views目录下。</p>
<p>需要安装express、xtpl、xtemplate 模块，package.json：</p>
<div class="highlight"><pre><code class="javascript">{
    <span class="string">"name"</span>: <span class="string">"xtemplate-express-demo"</span>,
    <span class="string">"description"</span>: <span class="string">"xtemplate on express demo"</span>,
    <span class="string">"devDependencies"</span>: {
        <span class="string">"express"</span>: <span class="string">"~3.4.8"</span>,
        <span class="string">"xtemplate"</span>: <span class="string">"^3.1.0"</span>,
        <span class="string">"xtpl"</span>: <span class="string">"^3.1.0"</span>
    }
}</code></pre></div><p>xtpl 是xtemplate模板引擎针对express和koa的适配器。</p>
<p>开启xtpl对express的适配：</p>
<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> xtpl = require(<span class="string">'xtpl'</span>);
<span class="comment">//开启express适配</span>
xtpl.__express = xtpl.renderFile;</code></pre></div><p>配置http服务：</p>
<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> http = require(<span class="string">'http'</span>);
<span class="keyword">var</span> app = require(<span class="string">'express'</span>)();
server = http.createServer(app);
app.set(<span class="string">'views'</span>,<span class="string">'./views'</span>);
<span class="comment">//留意模板引擎使用xtpl，而不是jade</span>
app.set(<span class="string">'view engine'</span>, <span class="string">'xtpl'</span>);
app.set(<span class="string">'port'</span>, <span class="number">3000</span>);

server.listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    console.log(<span class="string">"Express server listening on port "</span> + app.get(<span class="string">'port'</span>));
});</code></pre></div><p>在views下放一个简单的模板，比如simple.xtpl，模板内容如下：</p>
<pre>&lt;h1&gt;{{title}}&lt;/h1&gt;
&lt;p&gt;这是一个简单的demo&lt;/p&gt;</pre><p>起一个简单地路由渲染此模板：</p>
<div class="highlight"><pre><code class="javascript">app.get(<span class="string">'/simple'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>{</span>
    res.render(<span class="string">'simple'</span>,{title:<span class="string">'xtemplate'</span>});
});</code></pre></div><p>res.render() 第一个参数为模板名，simple 指向的是views/simple.xtpl，第二个参数为数据。</p>
<p>运行命令：node app.js 后访问 <a href="http://localhost:3000/simple，就可以看到渲染接过，就这么简单！">http://localhost:3000/simple，就可以看到渲染接过，就这么简单！</a></p>
<h2 id="xtemplate在实际业务中的应用">xtemplate在实际业务中的应用<a href="#xtemplate在实际业务中的应用" class="anchor">¶</a></h2><p>在实际业务中模板会比较复杂，为了方便维护，我们会把模板抽成多个部分。比如通用于所有页面的layout（页面结构），多个页面通用的模板，方便维护。</p>
<p>起个首页路由：</p>
<div class="highlight"><pre><code class="javascript">app.get(<span class="string">'/index'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>{</span>
    res.render(<span class="string">'xtemplate/4.0.3/index'</span>,{title:<span class="string">'xtemplate'</span>,content:<span class="string">'this is demo'</span>});
});</code></pre></div><p>index.xtpl使用，通用的pc layout：</p>
<div class="highlight"><pre><code class="javascript">{{extend (<span class="string">"./layout/pc/pc"</span>)}}</code></pre></div><p>使用extend 语法，让index模板继承个layout模板，这样就拥有这个layout的模板内容。</p>
<p>但是，layout的head和body的内容，各个页面都不同，我们如何将index页面模板内容插入到layout的head和body呢？</p>
<p>layout 增加二个block（块）定义：</p>
<div class="highlight"><pre><code class="javascript">&lt;head&gt;
    {{{block ("head")}}}
&lt;/head&gt;
&lt;body&gt;
    {{{block ("body")}}}
&lt;/body&gt;</code></pre></div><p>（必须留意：block语法需要三个{！！！坑爹的语法糖）</p>
<p>这样我们就可以在index.xtpl中定义这二个block的内容：</p>
<pre>{{#block (&quot;head&quot;)}}
    &lt;style&gt;
        p{
            line-height: 24px;
        }
    &lt;/style&gt;
{{/block}}

{{#block (&quot;body&quot;)}}
    &lt;p&gt;这是正文&lt;/p&gt;
{{/block}}</pre><p>（留意：这里的block语法不需要三个{！！！）</p>
<h2 id="使用子模板">使用子模板<a href="#使用子模板" class="anchor">¶</a></h2><p>xtemplate 跟大多数模板一样，是支持include子模板的，比如有个子模板demo.xtpl，在index.xtpl中使用：</p>
<pre>{{#block (&quot;body&quot;)}}
    &lt;p&gt;这是正文&lt;/p&gt;
    {{{include (&quot;./mod/demo&quot;)}}}
{{/block}}</pre><p>（特别留意：include语法需要三个{！！！）</p>
<h2 id="在koa中使用xtemplate">在koa中使用xtemplate<a href="#在koa中使用xtemplate" class="anchor">¶</a></h2><p>koa与express只是使用上有些差异：一个简单的demo工程。</p>
<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> koa = require(<span class="string">'koa'</span>);
<span class="comment">//使用跟express相似的路由器</span>
<span class="keyword">var</span> router = require(<span class="string">'koa-router'</span>);
<span class="keyword">var</span> app = koa();
app.use(router(app));</code></pre></div><p>开启xtemplate对koa的适配：</p>
<div class="highlight"><pre><code class="javascript"><span class="comment">//xtpl模板引擎对koa的适配</span>
<span class="keyword">var</span> xtplApp = require(<span class="string">'xtpl/lib/koa'</span>);
<span class="comment">//xtemplate模板渲染</span>
xtplApp(app,{
    <span class="comment">//配置模板目录redis</span>
    views: <span class="string">'./views'</span>
});</code></pre></div><p>路由写法有些差异（koa用法不是本文重点，可以看koa文档）：</p>
<div class="highlight"><pre><code class="javascript">app.get(<span class="string">'/simple'</span>,<span class="function"><span class="keyword">function</span> *<span class="params">()</span>{</span>
    <span class="keyword">yield</span> <span class="keyword">this</span>.render(<span class="string">'simple'</span>,{title:<span class="string">'xtemplate'</span>});
});
app.get(<span class="string">'/index'</span>,<span class="function"><span class="keyword">function</span> *<span class="params">()</span>{</span>
    <span class="keyword">yield</span> <span class="keyword">this</span>.render(<span class="string">'xtemplate/4.0.3/index'</span>,{title:<span class="string">'xtemplate'</span>,content:<span class="string">'this is demo'</span>});
});</code></pre></div><p>调用this.render()来渲染模板。</p>

  </div>
</article>

      </div>
      
    </div>
    <div class="footer-wrapper">
      <footer>
        <p class="footer-powered"><a href="http://spmjs.io">spmjs.io</a> •
<a href="https://github.com/spmjs/spm">spm</a> •
<a href="http://seajs.org">Sea.js</a> •
<a href="http://lab.lepture.com/nico/">nico</a>
        </p>
      </footer>
    </div>
  </body>
  <script src="../../static/js/nprogress.js?nowrap"></script>
  <script>
  (function() {
    NProgress.start();
    window.onload = NProgress.done;
    var ready = function(fn) {
      var doc = document;
      if(doc.addEventListener) {
        doc.addEventListener('DOMContentLoaded', fn, false);
      } else {
        doc.attachEvent('onreadystatechange', fn);
      }
    };
    ready(function() {
      NProgress.inc(0.6);

      seajs.use("../../static/js/arale-qrcode.js?nowrap", function(QRCode) {
        var url = location.href;
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
          url = url.replace(location.hostname, '192.168.1.15');
        }
        var el = new QRCode({
          text: url,
          render: 'canvas',
          width: 120,
          height: 120
        });
        document.getElementById('qrcode').appendChild(el);
      });
    }, false);
  })();
  </script>
</html>