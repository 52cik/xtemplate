modulex.add("xtemplate/runtime",[],function(n,t,e){var r,i,a,o,s;r=function(n){function t(){var n="";for(var t in r)n+=t+"|";return n=n.slice(0,-1),a=new RegExp(n,"g")}var e,r={"&":"&amp;",">":"&gt;","<":"&lt;","`":"&#x60;","/":"&#x2F;",'"':"&quot;","'":"&#x27;"},i=/[&<>"'`]/,a=t(),o=/\\?\{([^{}]+)\}/g,s="undefined"!=typeof global?global:window,f=Object.prototype.toString;return n=e={isArray:Array.isArray||function(n){return"[object Array]"===f.call(n)},keys:Object.keys||function(n){var t,e=[];for(t in n)n.hasOwnProperty(t)&&e.push(t);return e},each:function(n,t,r){if(n){var i,a,o,s=0,f=n&&n.length,u=void 0===f||"[object Function]"===Object.prototype.toString.call(n);if(r=r||null,u)for(o=e.keys(n);s<o.length&&(i=o[s],t.call(r,n[i],i,n)!==!1);s++);else for(a=n[0];f>s&&t.call(r,a,s,n)!==!1;a=n[++s]);}return n},mix:function(n,t){for(var e in t)n[e]=t[e];return n},globalEval:function(n){s.execScript?s.execScript(n):!function(n){s.eval.call(s,n)}(n)},substitute:function(n,t,e){return"string"==typeof n&&t?n.replace(e||o,function(n,e){return"\\"===n.charAt(0)?n.slice(1):void 0===t[e]?"":t[e]}):n},escapeHtml:function(n){return n=""+n,i.test(n)?(n+"").replace(a,function(n){return r[n]}):n},merge:function(){for(var n=0,t=arguments.length,r={};t>n;n++){var i=arguments[n];i&&e.mix(r,i)}return r}}}(),i=function(n){function t(n,t,e){this.data=void 0!==n?n:{},e?(this.parent=e,this.root=e.root):(this.parent=void 0,this.root=this),this.affix=t||{},this.ready=!1}return t.prototype={isScope:1,constructor:t,setParent:function(n){this.parent=n,this.root=n.root},set:function(n,t){this.affix[n]=t},setData:function(n){this.data=n},getData:function(){return this.data},mix:function(n){var t=this.affix;for(var e in n)t[e]=n[e]},get:function(n){var t,e=this.data,r=this.affix;return null!=e&&(t=e[n]),void 0!==t?t:r[n]},resolveInternalOuter:function(n){var t,e=n[0],r=this,i=r;if("this"===e)t=r.data;else if("root"===e)i=i.root,t=i.data;else{if(!e)return[i.data];do t=i.get(e);while(void 0===t&&(i=i.parent))}return[void 0,t]},resolveInternal:function(n){var t=this.resolveInternalOuter(n);if(1===t.length)return t[0];var e,r=n.length,i=t[1];for(e=1;r>e;e++)i=i[n[e]];return i},resolveLooseInternal:function(n){var t=this.resolveInternalOuter(n);if(1===t.length)return t[0];var e,r=n.length,i=t[1];for(e=1;null!=i&&r>e;e++)i=i[n[e]];return i},resolveUp:function(n){return this.parent&&this.parent.resolveInternal(n)},resolveLooseUp:function(n){return this.parent&&this.parent.resolveLooseInternal(n)},resolveOuter:function(n,t){var e,r=this,i=r;if(!t&&1===n.length){if(e=r.get(n[0]),void 0!==e)return[e];t=1}if(t)for(;i&&t--;)i=i.parent;return i?[void 0,i]:[void 0]},resolveLoose:function(n,t){var e=this.resolveOuter(n,t);return 1===e.length?e[0]:e[1].resolveLooseInternal(n)},resolve:function(n,t){var e=this.resolveOuter(n,t);return 1===e.length?e[0]:e[1].resolveInternal(n)}},n=t}(),a=function(n){function t(n,t,e){this.list=n,this.init(),this.next=t,this.ready=!1,this.tpl=e}function e(n,e){var r=this;r.config=e,r.head=new t(r,void 0),r.callback=n,this.init()}var i=r;return t.prototype={constructor:t,isBuffer:1,init:function(){this.data=""},append:function(n){return this.data+=n,this},write:function(n){if(null!=n){if(n.isBuffer)return n;this.data+=n}return this},writeEscaped:function(n){if(null!=n){if(n.isBuffer)return n;this.data+=i.escapeHtml(n)}return this},insert:function(){var n=this,e=n.list,r=n.tpl,i=new t(e,n.next,r),a=new t(e,i,r);return n.next=a,n.ready=!0,a},async:function(n){var t=this.insert(),e=t.next;return n(t),e},error:function(n){var t=this.list.callback;if(t){var e=this.tpl;if(e){n instanceof Error||(n=new Error(n));var r=e.name,i=e.pos.line,a="At "+r+":"+i+": ";n.stack=a+n.stack,n.message=a+n.message,n.xtpl={pos:{line:i},name:r}}this.list.callback=null,t(n,void 0)}},end:function(){var n=this;return n.list.callback&&(n.ready=!0,n.list.flush()),n}},e.prototype={constructor:e,init:function(){this.data=""},append:function(n){this.data+=n},end:function(){this.callback(null,this.data),this.callback=null},flush:function(){for(var n=this,t=n.head;t;){if(!t.ready)return n.head=t,void 0;this.data+=t.data,t=t.next}n.end()}},e.Buffer=t,n=e}(),o=function(n){var t=i,e=r,a={range:function(n,t){var e=t.params,r=e[0],i=e[1],a=e[2];a?(r>i&&a>0||i>r&&0>a)&&(a=-a):a=r>i?-1:1;for(var o=[],s=r;i>r?i>s:s>i;s+=a)o.push(s);return o},foreach:function(n,e,r){var i,a,o,s,f=e.params,u=f[0],c=f[2]||"xindex",l=f[1];if(u)for(i=u.length,s=0;i>s;s++)a=new t(u[s],{xcount:i,xindex:s},n),o=a.affix,"xindex"!==c&&(o[c]=s,o.xindex=void 0),l&&(o[l]=u[s]),r=e.fn(a,r);return r},forin:function(n,e,r){var i,a,o,s=e.params,f=s[0],u=s[2]||"xindex",c=s[1];if(f)for(o in f)i=new t(f[o],{xindex:o},n),a=i.affix,"xindex"!==u&&(a[u]=o,a.xindex=void 0),c&&(a[c]=f[o]),r=e.fn(i,r);return r},each:function(n,t,r){var i=t.params,o=i[0];return o?e.isArray(o)?a.foreach(n,t,r):a.forin(n,t,r):r},"with":function(n,e,r){var i=e.params,a=i[0];if(a){var o=new t(a,void 0,n);r=e.fn(o,r)}return r},"if":function(n,t,e){var r=t.params,i=r[0];if(i){var a=t.fn;a&&(e=a(n,e))}else{var o=!1,s=t.elseIfs,f=t.inverse;if(s)for(var u=0,c=s.length;c>u;u++){var l=s[u];if(o=l.test(n)){e=l.fn(n,e);break}}!o&&f&&(e=f(n,e))}return e},set:function(n,t,e){return n.mix(t.hash),e},include:1,parse:1,extend:1,block:function(n,t,e){var r,i=this,a=i.runtime,o=t.params,s=o[0];2===o.length&&(r=o[0],s=o[1]);var f,u=a.blocks=a.blocks||{},c=u[s],l={fn:t.fn,type:r};if(c){if(c.type)if("append"===c.type)l.next=c,u[s]=l;else if("prepend"===c.type){var v;for(f=c;f&&"prepend"===f.type;)v=f,f=f.next;l.next=f,v.next=l}}else u[s]=l;if(!a.extendTplName)for(f=u[s];f;)f.fn&&(e=f.fn.call(i,n,e)),f=f.next;return e},macro:function(n,e,r){var i=e.hash,a=e.params,o=a[0],s=a.slice(1),f=this,u=f.runtime,c=u.macros=u.macros||{};if(e.fn)c[o]={paramNames:s,hash:i,fn:e.fn};else{var l,v=c[o],d=v.hash||{};if(v&&(l=v.paramNames)){for(var h=0,p=l.length;p>h;h++){var m=l[h];d[m]=s[h]}if(i)for(var x in i)d[x]=i[x];var g=new t(d);r=v.fn.call(f,g,r)}else{var y="can not find macro: "+name;r.error(y)}}return r}};return a["debugger"]=function(){},n=a}(),s=function(t){function e(n,t,e,r,i,a,o){this.name=n,this.originalName=a||n,this.runtime=t,this.root=e,this.pos={line:1},this.scope=r,this.buffer=i,this.fn=o}function s(n,t,e){var r=e[0],i=n&&n[r]||t&&t[r]||g[r];if(1===e.length)return i;if(i)for(var a=e.length,o=1;a>o;o++)if(i=i[e[o]],!i)return!1;return i}function f(n,t){var e=n.split("/"),r=t.split("/");e.pop();for(var i=0,a=r.length;a>i;i++){var o=r[i];"."===o||(".."===o?e.pop():e.push(o))}return e.join("/")}function u(n,t,e,r,i,a){var o,f,u;return a||(u=s(n.runtime.commands,n.root.config.commands,i)),u?u.call(n,t,e,r):u!==!1&&(o=t.resolve(i.slice(0,-1),a),f=o[i[i.length-1]])?f.apply(o,e.params):(r.error("Command Not Found: "+i.join(".")),r)}function c(n,t){var e=this;e.fn=n,t=e.config=t||{},t.loader=t.loader||c.loader,this.subNameResolveCache={}}function l(n,t,e){if("."!==t.charAt(0))return t;var r=e+"_ks_"+t,i=n.subNameResolveCache,a=i[r];return a?a:t=i[r]=f(e,t)}function v(n,t,e,r,i,a){var o=l(n,a,i.name),s=r.insert(),f=s.next;return h(n,o,i.runtime,t,s,a,e),f}function d(n,t,r,i,a){var o=r.insert(),s=o.next,f=new e(a.TPL_NAME,i.runtime,n,t,o,void 0,a);return o.tpl=f,p(f),s}function h(n,t,r,i,a,o,s){var f=new e(t,r,n,i,a,o);a.tpl=f,n.config.loader.load(f,function(n,t){"function"==typeof t?(f.fn=t,p(f)):n?a.error(n):t&&(s?a.writeEscaped(t):a.data+=t,a.end())})}function p(n){var t=n.fn();if(t){var e=n.runtime,r=e.extendTplName,i=e.extendTplFn;return i?(e.extendTplName=null,e.extendTplFn=null,t=d(n.root,n.scope,t,n,i)):r&&(e.extendTplName=null,t=v(n.root,n.scope,0,t,n,r)),t.end()}}var m=r,x=o,g={},y=i,w=a,b={callFn:u,callCommand:function(n,t,e,r,i){return u(n,t,e,r,i)}},k={cache:{},load:function(t,e){var r=this.cache,i=t.name,a=r[i];return void 0!==a?e(void 0,a):(n([i],function(n){r[i]=n,e(void 0,n)},function(){var n='template "'+i+'" does not exist';console.error(n),e(n)}),void 0)}};return m.mix(c,{loader:k,version:"3.2.2",nativeCommands:x,utils:b,util:m,addCommand:function(n,t){g[n]=t},removeCommand:function(n){delete g[n]}}),c.prototype={constructor:c,Scope:y,nativeCommands:x,utils:b,removeCommand:function(n){var t=this.config;t.commands&&delete t.commands[n]},addCommand:function(n,t){var e=this.config;e.commands=e.commands||{},e.commands[n]=t},include:function(n,t,e,r){var i,a=t.params;i=n;var o=t.hash,s=t&&t.escape;return o&&(i=new y(o,void 0,n)),e=v(this,i,s,e,r,a[0])},includeModule:function(n,t,e,r){var i,a=t.params;i=n;var o=t.hash;return o&&(i=new y(o,void 0,n)),e=d(this,i,e,r,a[0])},render:function(n,t,r){var i="",a=this,o=a.fn,s=a.config;"function"==typeof t&&(r=t,t=null),t=t||{},r=r||function(n,t){if(n)throw n instanceof Error||(n=new Error(n)),n;i=t};var f=a.config.name;!f&&o&&o.TPL_NAME&&(f=o.TPL_NAME);var u=new y(n),l=new c.LinkedBuffer(r,s).head,v=new e(f,{commands:t.commands},a,u,l,f,o);return l.tpl=v,o?(p(v),i):(s.loader.load(v,function(n,t){t?(v.fn=a.fn=t,p(v)):n&&l.error(n)}),i)}},c.Scope=y,c.LinkedBuffer=w,t=c}(),e.exports=s});