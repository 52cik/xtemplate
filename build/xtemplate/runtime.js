modulex.add("xtemplate/runtime",["./runtime/util","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(n,t,e){function r(n,t,e){var r=e[0],i=n&&n[r]||t&&t[r]||c[r];if(1===e.length)return i;if(i)for(var a=e.length,o=1;a>o&&(i=i[e[o]],i);o++);return i}function i(n,t){var e=n.split("/"),r=t.split("/");e.pop();for(var i=0,a=r.length;a>i;i++){var o=r[i];"."===o||(".."===o?e.pop():e.push(o))}return e.join("/")}function a(n,t,e){e=n.fn(t,e);var r=n.runtime.extendTplName;return r&&(delete n.runtime.extendTplName,e=n.root.include(r,n,t,null,e)),e.end()}function o(n,t,e,i,a,o,f,u){var s,c,l,m;if(o||(m=r(n.runtime.commands,n.root.config.commands,a)),m)return m.call(n,t,e,i,f);if(s="in file: "+n.name+" can not call: "+a.join(".")+'" at line '+f,u&&(c=t.resolve(a.slice(0,-1),o),l=c[a[a.length-1]]))return l.apply(c,e.params);if(s)throw new Error(s);return i}function f(n,t){var e=this;e.fn=n,t=e.config=t||{},t.loader=t.loader||f.loader,this.subNameResolveCache={}}var u=n("./runtime/util"),s=n("./runtime/commands"),c={},l=n("./runtime/scope"),m=n("./runtime/linked-buffer"),d={callFn:function(n,t,e,r,i,a,f){return o(n,t,e,r,i,a,f,!0)},callCommand:function(n,t,e,r,i,a){return o(n,t,e,r,i,0,a,!0)}},h={cache:{},load:function(t,e){var r=t.name,i=this.cache;return i[r]?e(void 0,i[r]):void n([r],{success:function(n){i[r]=n,e(void 0,n)},error:function(){var n='template "'+t.name+'" does not exist';u.log(n,"error"),e(n)}})}};u.mix(f,{loader:h,nativeCommands:s,utils:d,util:u,addCommand:function(n,t){c[n]=t},removeCommand:function(n){delete c[n]}}),f.prototype={constructor:f,Scope:l,nativeCommands:s,utils:d,removeCommand:function(n){var t=this.config;t.commands&&delete t.commands[n]},addCommand:function(n,t){var e=this.config;e.commands=e.commands||{},e.commands[n]=t},resolve:function(n,t){if("."!==n.charAt(0))return n;if(!t){var e="parent template does not have name for relative sub tpl name: "+n;throw new Error(e)}var r=this.subNameResolveCache[t]=this.subNameResolveCache[t]||{};return r[n]?r[n]:n=r[n]=i(t,n)},include:function(n,t,e,r,i){var o=this,f=t.name,u=o.resolve(n,f);return i.async(function(i){o.config.loader.load({root:o,parentName:f,originalName:n,name:u,scope:e,option:r},function(n,o){n?i.error(n):"string"==typeof o?i.write(o,r&&r.escape).end():a({root:t.root,fn:o,name:u,runtime:t.runtime},e,i)})})},render:function(n,t,e){var r="",i=this,o=i.fn;"function"==typeof t&&(e=t,t=null),t=t||{},e=e||function(n,t){if(n)throw n instanceof Error||(n=new Error(n)),n;r=t};var u=i.config.name;!u&&o.TPL_NAME&&(u=o.TPL_NAME);var s=new l(n),c=new f.LinkedBuffer(e,i.config).head;return a({name:u,fn:o,runtime:{commands:t.commands},root:i},s,c),r}},f.Scope=l,f.LinkedBuffer=m,e.exports=f}),modulex.add("xtemplate/runtime/util",[],function(n,t,e){function r(){var n="";for(var t in a)n+=t+"|";return n=n.slice(0,-1),f=new RegExp(n,"g")}var i,a={"&":"&amp;",">":"&gt;","<":"&lt;","`":"&#x60;","/":"&#x2F;",'"':"&quot;","'":"&#x27;"},o=/[&<>"'`]/,f=r(),u=/\\?\{([^{}]+)\}/g,s="undefined"!=typeof global?global:window,c=Object.prototype.toString;e.exports=i={isArray:Array.isArray||function(n){return c.call(n)},keys:Object.keys||function(n){var t,e=[];for(t in n)n.hasOwnProperty(t)&&e.push(t);return e},each:function(n,t,e){if(n){var r,a,o,f=0,u=n&&n.length,s=void 0===u||"[object Function]"===Object.prototype.toString.call(n);if(e=e||null,s)for(o=i.keys(n);f<o.length&&(r=o[f],t.call(e,n[r],r,n)!==!1);f++);else for(a=n[0];u>f&&t.call(e,a,f,n)!==!1;a=n[++f]);}return n},mix:function(n,t){for(var e in t)n[e]=t[e];return n},globalEval:function(n){s.execScript?s.execScript(n):!function(n){s.eval.call(s,n)}(n)},substitute:function(n,t,e){return"string"==typeof n&&t?n.replace(e||u,function(n,e){return"\\"===n.charAt(0)?n.slice(1):void 0===t[e]?"":t[e]}):n},escapeHtml:function(n){return n||0===n||n===!1?(n=""+n,o.test(n)?(n+"").replace(f,function(n){return a[n]}):n):""},log:function(){"undefined"!=typeof console&&console.log.apply(console,arguments)}}}),modulex.add("xtemplate/runtime/commands",["./scope","./util"],function(n,t,e){var r=n("./scope"),i=n("./util"),a={range:function(n,t){var e=t.params,r=e[0],i=e[1],a=e[2];a?(r>i&&a>0||i>r&&0>a)&&(a=-a):a=r>i?-1:1;for(var o=[],f=r;i>r?i>f:f>i;f+=a)o.push(f);return o},each:function(n,t,e){var a,o,f,u=t.params,s=u[0],c=u[2]||"xindex",l=u[1];if(s)if(i.isArray(s)){a=s.length;for(var m=0;a>m;m++)o=new r(s[m]),f=o.affix={xcount:a},f[c]=m,l&&(f[l]=s[m]),o.setParent(n),e=t.fn(o,e)}else for(var d in s)o=new r(s[d]),f=o.affix={},f[c]=d,l&&(f[l]=s[d]),o.setParent(n),e=t.fn(o,e);return e},"with":function(n,t,e){var i=t.params,a=i[0];if(a){var o=new r(a);o.setParent(n),e=t.fn(o,e)}return e},"if":function(n,t,e){var r=t.params,i=r[0];if(i){var a=t.fn;a&&(e=a(n,e))}else{var o=!1,f=t.elseIfs,u=t.inverse;if(f)for(var s=0,c=f.length;c>s;s++){var l=f[s];if(o=l.test(n)){e=l.fn(n,e);break}}!o&&u&&(e=u(n,e))}return e},set:function(n,t,e){return n.mix(t.hash),e},include:function(n,t,e){var i,a,o=t.params,f=o.length;for(a=n,t.hash&&(a=new r(t.hash),a.setParent(n)),i=0;f>i;i++)e=this.root.include(o[i],this,a,t,e);return e},parse:function(n,t,e){return a.include.call(this,new r,t,e)},extend:function(n,t,e){return this.runtime.extendTplName=t.params[0],e},block:function(n,t,e){var r,i=this,a=i.runtime,o=t.params,f=o[0];2===o.length&&(r=o[0],f=o[1]);var u,s=a.blocks=a.blocks||{},c=s[f],l={fn:t.fn,type:r};if(c){if(c.type)if("append"===c.type)l.next=c,s[f]=l;else if("prepend"===c.type){var m;for(u=c;u&&"prepend"===u.type;)m=u,u=u.next;l.next=u,m.next=l}}else s[f]=l;if(!a.extendTplName)for(u=s[f];u;)u.fn&&(e=u.fn.call(i,n,e)),u=u.next;return e},macro:function(n,t,e,i){var a=t.hash,o=t.params,f=o[0],u=o.slice(1),s=this,c=s.runtime,l=c.macros=c.macros||{};if(t.fn)l[f]={paramNames:u,hash:a,fn:t.fn};else{var m,d=l[f],h=d.hash||{};if(!d||!(m=d.paramNames)){var p="in file: "+s.name+" can not find macro: "+name+'" at line '+i;throw new Error(p)}for(var v=0,x=m.length;x>v;v++){var g=m[v];h[g]=u[v]}if(a)for(var y in a)h[y]=a[y];var w=new r(h);e=d.fn.call(s,w,e)}return e}};a["debugger"]=function(){i.globalEval("debugger")},e.exports=a}),modulex.add("xtemplate/runtime/scope",[],function(n,t,e){function r(n){this.data=arguments.length?n:{},this.affix=i,this.root=this}var i;r.prototype={isScope:1,setParent:function(n){this.parent=n,this.root=n.root},set:function(n,t){this.affix||(this.affix={}),this.affix[n]=t},setData:function(n){this.data=n},getData:function(){return this.data},mix:function(n){var t=this.affix;t||(t=this.affix={});for(var e in n)t[e]=n[e]},get:function(n){var t,e=this.data,r=this.affix;return t=r&&r[n],t!==i?t:(e!==i&&null!==e&&(t=e[n]),t!==i?t:"this"===n?e:"root"===n?this.root.data:t)},resolve:function(n,t){var e,r=this;if(!t&&1===n.length){if(e=r.get(n[0]),e!==i)return e;t=1}var a,o=n.length,f=r;if(o&&"root"===n[0])n.shift(),f=f.root,o--;else if(t)for(;f&&t--;)f=f.parent;if(!f)return i;if(!o)return f.data;var u=n[0];do e=f.get(u);while(e===i&&(f=f.parent));if(e&&f){for(a=1;e&&o>a;a++)e=e[n[a]];return e}return i}},e.exports=r}),modulex.add("xtemplate/runtime/linked-buffer",["./util"],function(n,t,e){function r(n){this.list=n,this.init()}function i(n,t){var e=this;e.config=t,e.head=new r(e),e.callback=n,this.init()}var a,o=n("./util");r.prototype={constructor:r,isBuffer:1,init:function(){this.data=""},append:function(n){this.data+=n},write:function(n,t){return(n||0===n||n===!1)&&this.append(t?o.escapeHtml(n):n),this},async:function(n){var t=this,e=t.list,i=new r(e),a=new r(e);return a.next=t.next,i.next=a,t.next=i,t.ready=!0,n(i),a},error:function(n){var t=this.list.callback;t&&(t(n,a),this.list.callback=null)},end:function(n,t){var e=this;return e.list.callback&&(e.write(n,t),e.ready=!0,e.list.flush()),e}},i.prototype={constructor:i,init:function(){this.data=""},append:function(n){this.data+=n},end:function(){this.callback(null,this.data)},flush:function(){for(var n=this,t=n.head;t;){if(!t.ready)return;this.append(t.data),t=t.next,n.head=t}n.end()}},i.Buffer=r,e.exports=i});